---
title: "Class 6"
format: docx
execute:
  error: TRUE
---

# Plan
* Announcements
* Concept review
* Group Work 1: Distributions
* Short lecture - Regression Discontinuity
* Group work 2

# Concept Review: Checking Randomization Quality

```{r}
library(tidyverse)
crime  <- read.csv("./class_data/crime.csv")

#download.file("https://raw.githubusercontent.com/resonance1/govt10-f25/refs/heads/main/class_data/crime.csv","crime.csv")
#crime <- read.csv("crime.csv")

# ATE
crime |>
group_by(crimrec) %>%
summarize(call=mean(call))

# Randomization Quality
crime |>
group_by(crimrec) %>%
summarize(distance=mean(distance,na.rm=T),
          cust=mean(custserv,na.rm=T),
          manual=mean(manualskill,na.rm=T),
          city=mean(city,na.rm=T),
          black=mean(black,na.rm=T),
          n())

```

Using boxplot for continuous variables:

```{r}
boxplot()
```

Treatment effects by subgroup:

```{r}

```



# Group Work 1: Distributions 

```{r}
library(tidyverse)

chechen <- read.csv("./class_data/chechen.csv")

#download.file("https://raw.githubusercontent.com/resonance1/govt10-f25/refs/heads/main/class_data/chechen.csv","chechen.csv")
#chechen <- read.csv("chechen.csv")
```

Recall that this study looked at the effect of randomized artillery fire (variable: fire) on insurgent attacks (variable: postattack). We also introduced the following functions:

hist()
quantile()
boxplot()

If you don't remember how to use them, review class5.qmd.

1. Create a new variable in the dataset, called diffattack, which is defined as the change in attacks (postattack-preattack)

```{r}

```


2. Separately for the treated and control groups, calculate the median of diffattack as well as the 90th and 99th percentiles. Note: the quantile() function can go in summarize(). 

```{r}


```

3. Create a histogram of postattack

```{r}

```

4. Create a boxplot of postattack, comparing the treatment and control groups (fire):

```{r}


```

5. Since the mean of a variable is affected by outliers (skew), average treatment effects can also be affected by outliers. In other words, even if most units did not respond to the treatment, a large response among a small subset of treated units could generate an average difference between the treated and control groups.

For instance, consider the hypothetical case where there are 10 villages. 9 villages did not change their resistance activity following artillery fire. However, the remaining village had a decrease of 10 attacks in the period following artillery fire. In this case the average treatment effect on diffattack would have been -1, even though most villages did not change their behavior. When we look at just the average treatment effect, we cannot distinguish this case from a hypothetical situation in which each of the 10 villages had 1 less attack following the artillery fire -- the average treatment effect would be identical (-1).

Based on your answers above, is the average treatment effect in the Chechen study likely influenced by outliers? In other words, is the observed reduction in violence concentrated in a subset of villages, or did most villages decrease violent resistance following artillery fire?

*Answer here*

# Lecture: Natural Experiments: Regression Discontinuity

# Group Work 2: Regression Discontinuity (please complete)

We are going to examine the monetary returns to political office in the United Kingdom, by comparing the lifetime wealth of candidates who barely won a parliamentary election to those candidates who barely lost.

This study looks at the winners and losers of a single election. The sample is limited to those individuals who had died before the study was completed (2009); this way their full earnings over the life course can be observed.

The assumption is that candidates who barely won an election are similar to those who barely lost. However, the relatively small sample size of candidates implies that we cannot restrict the sample to very small values of the running variable (in this case, victory or loss margin). We will explore whether we can obtain findings by examining observations on either side of the victory/loss cutoff, selecting a cutoff that enables the Law of Large Numbers to apply.

Relevant variables:

ln.gross        Log of wealth upon death (from probate records)
yob             Year of birth
female          Whether candidate is female(1) or not (0)
margin          Victory or loss margin in the election being assessed; this is the "running variable" we will use to narrow the analysis window
local           Whether candidate was previously elected to a local political office (1) or not (0)

```{r}
library(tidyverse)

british_mp <- read.csv("./class_data/MP.csv")

#download.file("https://raw.githubusercontent.com/resonance1/govt10-f25/refs/heads/main/class_data/MP.csv","MP.csv")
#british_mp <- read.csv("MP.csv")

```

Create a histogram of *margin* to examine the distribution of the running variable

```{r}

```

Create a new variable called *victory* that receives a 1 if the vote margin is positive (indicating a victory), and a 0 if it is negative (indicating a loss). This will be our treatment variable.

Note: you'll have to use ifelse() for this. The syntax is ifelse(logical statement,value if true, value if false). If you don't remember how to use it, you can look at class5.qmd

```{r}


```

Using the treatment variable created above, compare three background characteristics of all candidates who won an election to the candidates who lost. Run this for 3 variables: yob, female, and local. Are the treatment and control groups similar on average?

```{r}

```

Now explore narrowing the window using filter() on the *margin* variable so that it only includes candidates who won or lost an election by +- 3.5 percentage points (i.e those that lost by no more than 3.5 percentage points, and those that won by no more than 3.5 percentage points). Recalculate differences in background characteristics (yob,female, local). Are the differences smaller? If so, why might we expect this to be the case?

If you can't figure out how to use the filter command to do this, please raise your hand!
_Hint: you'll need to use & within filter() for this to work_ 

```{r}

```

Save the filtered data (+- 3.5 percentage points) as a new dataset. Then use a boxplot to examine the distribution of yob, separately for those candidates who won and those who did not.

```{r}

```

Using the filtered data (+- 3.5 percentage points), calculate the average treatment effect on our outcome of interest: ln.gross (logged gross lifetime earnings).

```{r}


```

What does this suggest about the financial returns associated with elected office?

*Answer here*

Would you interpret these results as causal, or correlational? If correlational, what additional evidence would you like to see?

*Answer here*

The dataset also contains a variable called school, which indicated what school candidates went to. What proportion of candidates from Eton (a prestigious school) win parliamentary elections in the filtered dataset? 

To answer this question, you'll have to use group_by(school == ) or use ifelse() to create a new variable 

```{r}

```

The more background characteristics we have to evaluate, the better. Convert the information in the 'school' variable to binary variables. Then assess differences between the treatment and control groups to determine the quality of the "as-if random" assumption. Do your conclusions change? Interpret the results. 

```{r}

```

If you have time remaining, you can work on the problem set! I'll stay in the room to answer any questions you might have.


## Check-in

1. On a scale ranging between 1 (Too Hard) and 10 (Too Easy), how was today's class: 
2. What was the easiest thing to understand?
3. What was the most difficult thing to understand?